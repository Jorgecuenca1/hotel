{% extends 'base.html' %}

{% block title %}Nuevo Tipo de Habitación - Sistema de Gestión Hotelera{% endblock %}

{% block content %}
<div class="page-header d-flex justify-content-between align-items-center">
    <div>
        <h1><i class="fas fa-plus-circle"></i> Nuevo Tipo de Habitación</h1>
        <p class="mb-0">Crear un nuevo tipo de habitación para el hotel</p>
    </div>
    <div>
        <a href="{% url 'hotel:tipos_habitacion' %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Volver a Tipos
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-layer-group"></i> Información del Tipo</h5>
            </div>
            <div class="card-body">
                <form method="post" id="tipoForm">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="nombre" class="form-label">Nombre del Tipo <span class="text-danger">*</span></label>
                        <input type="text" name="nombre" id="nombre" class="form-control" 
                               placeholder="Ej: Individual, Doble, Suite, Presidencial" required>
                        <small class="text-muted">Debe ser único en el hotel</small>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="precio_por_noche" class="form-label">Precio por Noche <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" name="precio_por_noche" id="precio_por_noche" 
                                       class="form-control" step="0.01" min="0" placeholder="0.00" required>
                            </div>
                            <small class="text-muted">Precio base por noche</small>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="capacidad_personas" class="form-label">Capacidad <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input type="number" name="capacidad_personas" id="capacidad_personas" 
                                       class="form-control" min="1" max="20" placeholder="1" required>
                                <span class="input-group-text">persona(s)</span>
                            </div>
                            <small class="text-muted">Número máximo de huéspedes</small>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="descripcion" class="form-label">Descripción</label>
                        <textarea name="descripcion" id="descripcion" class="form-control" rows="4" 
                                  placeholder="Describe las características, amenidades y servicios incluidos..."></textarea>
                        <small class="text-muted">Opcional - Descripción detallada del tipo de habitación</small>
                    </div>
                    
                    <!-- Vista previa -->
                    <div class="card bg-light">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-eye"></i> Vista Previa</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <strong>Tipo:</strong> <span id="preview-nombre">-</span><br>
                                    <strong>Precio:</strong> <span id="preview-precio">$0.00</span>/noche<br>
                                    <strong>Capacidad:</strong> <span id="preview-capacidad">0</span> persona(s)
                                </div>
                                <div class="col-md-6">
                                    <strong>Descripción:</strong><br>
                                    <span id="preview-descripcion" class="text-muted">Sin descripción</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'hotel:tipos_habitacion' %}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="fas fa-save"></i> Crear Tipo
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-info-circle"></i> Instrucciones</h6>
            </div>
            <div class="card-body">
                <ol class="mb-3">
                    <li>Ingrese un nombre descriptivo y único</li>
                    <li>Establezca el precio base por noche</li>
                    <li>Defina la capacidad máxima de huéspedes</li>
                    <li>Agregue una descripción detallada</li>
                    <li>Revise la vista previa</li>
                    <li>Haga clic en "Crear Tipo"</li>
                </ol>
                
                <h6><i class="fas fa-lightbulb text-warning"></i> Consejos:</h6>
                <ul class="small mb-0">
                    <li>Use nombres claros: Individual, Doble, Suite</li>
                    <li>Considere amenidades en el precio</li>
                    <li>Sea específico en la descripción</li>
                    <li>Revise precios de la competencia</li>
                </ul>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-examples"></i> Ejemplos Comunes</h6>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <strong>Individual</strong><br>
                    <small class="text-muted">1 persona - $80/noche</small>
                </div>
                <div class="mb-2">
                    <strong>Doble</strong><br>
                    <small class="text-muted">2 personas - $120/noche</small>
                </div>
                <div class="mb-2">
                    <strong>Suite</strong><br>
                    <small class="text-muted">4 personas - $250/noche</small>
                </div>
                <div class="mb-0">
                    <strong>Presidencial</strong><br>
                    <small class="text-muted">6 personas - $500/noche</small>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Actualizar vista previa en tiempo real
document.addEventListener('DOMContentLoaded', function() {
    const nombreInput = document.getElementById('nombre');
    const precioInput = document.getElementById('precio_por_noche');
    const capacidadInput = document.getElementById('capacidad_personas');
    const descripcionInput = document.getElementById('descripcion');
    
    function actualizarVistaPrevia() {
        const nombre = nombreInput.value || '-';
        const precio = precioInput.value ? parseFloat(precioInput.value).toFixed(2) : '0.00';
        const capacidad = capacidadInput.value || '0';
        const descripcion = descripcionInput.value || 'Sin descripción';
        
        document.getElementById('preview-nombre').textContent = nombre;
        document.getElementById('preview-precio').textContent = '$' + precio;
        document.getElementById('preview-capacidad').textContent = capacidad;
        document.getElementById('preview-descripcion').textContent = descripcion;
    }
    
    nombreInput.addEventListener('input', actualizarVistaPrevia);
    precioInput.addEventListener('input', actualizarVistaPrevia);
    capacidadInput.addEventListener('input', actualizarVistaPrevia);
    descripcionInput.addEventListener('input', actualizarVistaPrevia);
    
    // Validación del formulario
    document.getElementById('tipoForm').addEventListener('submit', function(e) {
        const nombre = nombreInput.value.trim();
        const precio = precioInput.value;
        const capacidad = capacidadInput.value;
        
        if (!nombre || !precio || !capacidad) {
            e.preventDefault();
            alert('Por favor complete todos los campos obligatorios');
            return;
        }
        
        if (parseFloat(precio) <= 0) {
            e.preventDefault();
            alert('El precio debe ser mayor a 0');
            precioInput.focus();
            return;
        }
        
        if (parseInt(capacidad) <= 0) {
            e.preventDefault();
            alert('La capacidad debe ser mayor a 0');
            capacidadInput.focus();
            return;
        }
        
        if (nombre.length < 2) {
            e.preventDefault();
            alert('El nombre debe tener al menos 2 caracteres');
            nombreInput.focus();
            return;
        }
        
        // Confirmar creación
        if (!confirm(`¿Crear tipo "${nombre}" con precio $${precio} para ${capacidad} persona(s)?`)) {
            e.preventDefault();
            return;
        }
        
        // Desactivar botón para evitar doble envío
        document.getElementById('submitBtn').disabled = true;
        document.getElementById('submitBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creando...';
    });
});

// Autocompletar nombres comunes
const nombresComunes = ['Individual', 'Doble', 'Triple', 'Suite', 'Suite Junior', 'Suite Presidencial', 'Familiar', 'Matrimonial'];

document.getElementById('nombre').addEventListener('input', function() {
    // Aquí podrías implementar autocompletado si lo deseas
});
</script>
{% endblock %}